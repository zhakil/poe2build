# GUIä¸åç«¯AIåè°ƒå™¨é›†æˆç³»ç»Ÿ

æœ¬æ–‡æ¡£æè¿°äº†PoE2æ„ç­‘ç”Ÿæˆå™¨çš„GUIä¸åç«¯AIåè°ƒå™¨å®Œæ•´é›†æˆç³»ç»Ÿçš„æ¶æ„ã€åŠŸèƒ½å’Œä½¿ç”¨æ–¹æ³•ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GUIå‰ç«¯å±‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ BuildGeneratorPage  â”‚  ErrorHandler  â”‚  PoB2StatusWidget â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æœåŠ¡å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ BackendClient â”‚ DataConverter â”‚ StatusManager           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    åç«¯AIå±‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PoE2AIOrchestrator â”‚ RAGå¼•æ“ â”‚ PoB2é›†æˆ â”‚ æ•°æ®æº        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1. GUIæœåŠ¡å±‚

#### BackendClient (åç«¯é€šä¿¡å®¢æˆ·ç«¯)
**æ–‡ä»¶**: `src/poe2build/gui/services/backend_client.py`

**åŠŸèƒ½**:
- å¼‚æ­¥çš„AIåè°ƒå™¨è°ƒç”¨æ¥å£
- çº¿ç¨‹å®‰å…¨çš„æ•°æ®ä¼ è¾“
- å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- è¿›åº¦åé¦ˆå’ŒçŠ¶æ€æ›´æ–°
- PoB2æœåŠ¡é›†æˆæ£€æµ‹

**æ ¸å¿ƒæ–¹æ³•**:
```python
class BackendClient:
    async def initialize() -> bool              # åˆå§‹åŒ–åç«¯è¿æ¥
    def generate_build_async() -> bool          # å¼‚æ­¥ç”Ÿæˆæ„ç­‘
    def cancel_current_request() -> bool        # å–æ¶ˆå½“å‰è¯·æ±‚
    async def check_backend_health() -> dict   # æ£€æŸ¥åç«¯å¥åº·
    async def get_pob2_status() -> dict        # è·å–PoB2çŠ¶æ€
```

#### DataConverter (æ•°æ®è½¬æ¢å™¨)
**æ–‡ä»¶**: `src/poe2build/gui/services/data_converter.py`

**åŠŸèƒ½**:
- GUIè¡¨å•æ•°æ®åˆ°åç«¯è¯·æ±‚æ ¼å¼çš„è½¬æ¢
- åç«¯ç»“æœåˆ°GUIæ˜¾ç¤ºæ ¼å¼çš„è½¬æ¢
- æ•°æ®éªŒè¯å’Œæ¸…ç†
- ç±»å‹å®‰å…¨çš„è½¬æ¢

**æ ¸å¿ƒæ–¹æ³•**:
```python
class DataConverter:
    def gui_to_backend_request() -> ConversionResult    # GUIæ•°æ®è½¬æ¢
    def backend_to_gui_result() -> ConversionResult     # åç«¯ç»“æœè½¬æ¢
```

#### StatusManager (çŠ¶æ€ç®¡ç†å™¨)
**æ–‡ä»¶**: `src/poe2build/gui/services/status_manager.py`

**åŠŸèƒ½**:
- å®æ—¶çŠ¶æ€æ›´æ–°å’Œè¿›åº¦åé¦ˆ
- ç³»ç»Ÿå¥åº·çŠ¶æ€ç›‘æ§
- PoB2æœåŠ¡çŠ¶æ€è·Ÿè¸ª
- ç”¨æˆ·æ“ä½œçŠ¶æ€ç®¡ç†
- é”™è¯¯çŠ¶æ€å¤„ç†

**æ ¸å¿ƒæ–¹æ³•**:
```python
class StatusManager:
    def update_component_status()    # æ›´æ–°ç»„ä»¶çŠ¶æ€
    def update_progress()           # æ›´æ–°è¿›åº¦ä¿¡æ¯
    def report_error()              # æŠ¥å‘Šé”™è¯¯
    def get_system_status()         # è·å–ç³»ç»ŸçŠ¶æ€
```

### 2. GUIç»„ä»¶å±‚

#### ErrorHandler (é”™è¯¯å¤„ç†å™¨)
**æ–‡ä»¶**: `src/poe2build/gui/widgets/error_handler.py`

**åŠŸèƒ½**:
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ
- å¯æ¢å¤é”™è¯¯çš„é‡è¯•æœºåˆ¶
- ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
- é€šçŸ¥ç³»ç»Ÿé›†æˆ

**ç»„ä»¶**:
- `ErrorDialog` - é”™è¯¯å¯¹è¯æ¡†
- `NotificationWidget` - é€šçŸ¥å°ç»„ä»¶
- `ErrorHandler` - é”™è¯¯å¤„ç†ä¸»ç±»

#### PoB2StatusWidget (PoB2çŠ¶æ€ç›‘æ§)
**æ–‡ä»¶**: `src/poe2build/gui/widgets/pob2_status_widget.py`

**åŠŸèƒ½**:
- PoB2æœ¬åœ°å®¢æˆ·ç«¯çŠ¶æ€æ£€æµ‹
- PoB2 WebæœåŠ¡çŠ¶æ€ç›‘æ§
- å®æ—¶çŠ¶æ€æ›´æ–°æ˜¾ç¤º
- æœåŠ¡åˆ‡æ¢å’Œé…ç½®
- æ•…éšœè¯Šæ–­å’Œæ¢å¤å»ºè®®

### 3. é›†æˆçš„BuildGeneratorPage
**æ–‡ä»¶**: `src/poe2build/gui/pages/build_generator_page.py`

**æ–°å¢åŠŸèƒ½**:
- å®Œå…¨é‡æ„çš„åç«¯é›†æˆæ¶æ„
- å¼‚æ­¥æ„ç­‘ç”Ÿæˆæ”¯æŒ
- å®æ—¶è¿›åº¦åé¦ˆ
- é”™è¯¯å¤„ç†å’Œæ¢å¤
- PoB2çŠ¶æ€é›†æˆ
- å–æ¶ˆæ“ä½œæ”¯æŒ

## ğŸš€ ä¸»è¦ç‰¹æ€§

### 1. å¼‚æ­¥æ„ç­‘ç”Ÿæˆ
- **çº¿ç¨‹å®‰å…¨**: ä½¿ç”¨QThreadè¿›è¡Œåå°å¤„ç†
- **è¿›åº¦åé¦ˆ**: å®æ—¶æ›´æ–°ç”Ÿæˆè¿›åº¦å’ŒçŠ¶æ€
- **å¯å–æ¶ˆ**: æ”¯æŒç”¨æˆ·å–æ¶ˆé•¿æ—¶é—´è¿è¡Œçš„æ“ä½œ
- **é”™è¯¯æ¢å¤**: è‡ªåŠ¨é‡è¯•å’Œé™çº§å¤„ç†

### 2. æ™ºèƒ½é”™è¯¯å¤„ç†
- **åˆ†çº§é”™è¯¯**: Info/Warning/Error/Criticalå››ä¸ªçº§åˆ«
- **ç”¨æˆ·å‹å¥½**: è‡ªåŠ¨ç”Ÿæˆç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
- **æ¢å¤å»ºè®®**: æä¾›å…·ä½“çš„è§£å†³å»ºè®®å’Œæ“ä½œ
- **é”™è¯¯è¿½è¸ª**: å®Œæ•´çš„é”™è¯¯æ—¥å¿—å’Œå†å²è®°å½•

### 3. PoB2æœåŠ¡é›†æˆ
- **è‡ªåŠ¨æ£€æµ‹**: è‡ªåŠ¨æ£€æµ‹æœ¬åœ°PoB2å®‰è£…
- **çŠ¶æ€ç›‘æ§**: å®æ—¶ç›‘æ§PoB2æœåŠ¡çŠ¶æ€
- **æ™ºèƒ½åˆ‡æ¢**: æœ¬åœ°ä¸å¯ç”¨æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°Webç‰ˆæœ¬
- **è¯Šæ–­å·¥å…·**: æä¾›å®Œæ•´çš„è¯Šæ–­å’Œæ•…éšœæ’é™¤

### 4. å®æ—¶çŠ¶æ€åé¦ˆ
- **ç³»ç»Ÿå¥åº·**: ç›‘æ§æ‰€æœ‰ç»„ä»¶çš„å¥åº·çŠ¶æ€
- **è¿›åº¦è¿½è¸ª**: è¯¦ç»†çš„æ“ä½œè¿›åº¦å’Œæ—¶é—´ä¼°ç®—
- **é€šçŸ¥ç³»ç»Ÿ**: éä¾µå…¥å¼çš„çŠ¶æ€é€šçŸ¥
- **å†å²è®°å½•**: å®Œæ•´çš„æ“ä½œå’ŒçŠ¶æ€å†å²

## ğŸ“‹ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ç”¨æ³•

```python
# åˆ›å»ºæ„ç­‘ç”Ÿæˆå™¨é¡µé¢
backend_config = {
    'orchestrator': {
        'max_recommendations': 10,
        'pob2': {'enable_local': True, 'enable_web': True},
        'rag': {'confidence_threshold': 0.7}
    }
}

generator_page = BuildGeneratorPage(backend_config)
generator_page.build_generated.connect(handle_build_result)

# ç›‘å¬ç”Ÿæˆå®Œæˆ
def handle_build_result(result_data):
    builds = result_data.get('builds', [])
    print(f"ç”Ÿæˆäº† {len(builds)} ä¸ªæ„ç­‘æ¨è")
```

### é”™è¯¯å¤„ç†

```python
# ä½¿ç”¨é”™è¯¯å¤„ç†å™¨
error_handler = ErrorHandler()

# å¤„ç†å¼‚å¸¸
try:
    risky_operation()
except Exception as e:
    error_handler.handle_error(
        error=e,
        context="æ„ç­‘ç”Ÿæˆ",
        title="ç”Ÿæˆå¤±è´¥",
        recoverable=True,
        retry_action=retry_generation
    )

# æ˜¾ç¤ºé€šçŸ¥
error_handler.show_notification(
    NotificationType.SUCCESS,
    "æ“ä½œå®Œæˆ",
    "æ„ç­‘å·²æˆåŠŸç”Ÿæˆ"
)
```

### PoB2çŠ¶æ€ç›‘æ§

```python
# åˆ›å»ºPoB2çŠ¶æ€ç›‘æ§å™¨
pob2_widget = PoB2StatusWidget(backend_client)

# ç›‘å¬çŠ¶æ€å˜åŒ–
pob2_widget.settings_changed.connect(handle_pob2_settings)

# è·å–å½“å‰çŠ¶æ€
status = pob2_widget.get_current_status()
print(f"PoB2å¯ç”¨æ€§: {status['available']}")
```

## ğŸ”§ é…ç½®é€‰é¡¹

### åç«¯é…ç½®

```python
backend_config = {
    'orchestrator': {
        'max_recommendations': 10,     # æœ€å¤§æ¨èæ•°é‡
        'cache_ttl': 3600,            # ç¼“å­˜æœ‰æ•ˆæœŸ(ç§’)
        'pob2': {
            'enable_local': True,      # å¯ç”¨æœ¬åœ°PoB2
            'enable_web': True,        # å¯ç”¨Web PoB2
            'timeout': 30              # è¿æ¥è¶…æ—¶(ç§’)
        },
        'rag': {
            'confidence_threshold': 0.7, # RAGç½®ä¿¡åº¦é˜ˆå€¼
            'max_results': 20           # RAGæœ€å¤§ç»“æœæ•°
        },
        'retry': {
            'max_attempts': 3,          # æœ€å¤§é‡è¯•æ¬¡æ•°
            'backoff_factor': 2.0       # é‡è¯•å»¶è¿Ÿå€æ•°
        }
    },
    'max_retries': 3,                  # å®¢æˆ·ç«¯é‡è¯•æ¬¡æ•°
    'retry_delay': 1000                # é‡è¯•å»¶è¿Ÿ(æ¯«ç§’)
}
```

### çŠ¶æ€ç®¡ç†é…ç½®

```python
# çŠ¶æ€æ£€æŸ¥é—´éš”
status_check_interval = 30000  # 30ç§’

# é”™è¯¯é‡è¯•å»¶è¿Ÿ
error_retry_delay = 5000       # 5ç§’

# å†å²è®°å½•é™åˆ¶
max_history_size = 100         # æœ€å¤§å†å²è®°å½•æ•°
```

## ğŸ¯ æ ¸å¿ƒå·¥ä½œæµç¨‹

### 1. æ„ç­‘ç”Ÿæˆæµç¨‹

```
ç”¨æˆ·è¾“å…¥ â†’ æ•°æ®éªŒè¯ â†’ åç«¯è½¬æ¢ â†’ å¼‚æ­¥ç”Ÿæˆ â†’ è¿›åº¦æ›´æ–° â†’ ç»“æœå¤„ç† â†’ UIæ›´æ–°
    â†“         â†“         â†“         â†“         â†“         â†“         â†“
   GUI     Converter  Backend   Thread    Status   Converter   GUI
```

### 2. é”™è¯¯å¤„ç†æµç¨‹

```
å¼‚å¸¸å‘ç”Ÿ â†’ é”™è¯¯åˆ†ç±» â†’ ç”Ÿæˆå»ºè®® â†’ ç”¨æˆ·é€šçŸ¥ â†’ é‡è¯•é€‰é¡¹ â†’ çŠ¶æ€æ¢å¤
    â†“         â†“         â†“         â†“         â†“         â†“
Exception  Handler   Suggestions Notice   Recovery  Status
```

### 3. çŠ¶æ€ç›‘æ§æµç¨‹

```
å®šæ—¶æ£€æŸ¥ â†’ çŠ¶æ€æ›´æ–° â†’ ç»„ä»¶é€šçŸ¥ â†’ UIåˆ·æ–° â†’ å†å²è®°å½•
    â†“         â†“         â†“         â†“         â†“
   Timer    Manager   Components  GUI     History
```

## ğŸ§ª æ¼”ç¤ºå’Œæµ‹è¯•

### è¿è¡Œæ¼”ç¤ºç¨‹åº

```bash
# è¿è¡Œå®Œæ•´é›†æˆæ¼”ç¤º
python demo_gui_backend_integration.py
```

### æ¼”ç¤ºåŠŸèƒ½åŒ…æ‹¬:
- AIæ„ç­‘ç”Ÿæˆæµç¨‹
- é”™è¯¯å¤„ç†å’Œæ¢å¤
- PoB2çŠ¶æ€ç›‘æ§
- å®æ—¶é€šçŸ¥ç³»ç»Ÿ
- è¿›åº¦åé¦ˆæœºåˆ¶

### æµ‹è¯•ç¯å¢ƒè¦æ±‚:
- Python 3.8+
- PyQt6
- æ‰€æœ‰åç«¯ä¾èµ–é¡¹
- å¯é€‰: æœ¬åœ°PoB2å®‰è£…

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **åç«¯è¿æ¥å¤±è´¥**
   - æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨
   - éªŒè¯ç½‘ç»œè¿æ¥
   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—

2. **PoB2æ£€æµ‹å¤±è´¥**
   - ç¡®è®¤PoB2å®‰è£…è·¯å¾„
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
   - å°è¯•Webç‰ˆæœ¬

3. **æ„ç­‘ç”Ÿæˆè¶…æ—¶**
   - å¢åŠ è¶…æ—¶è®¾ç½®
   - æ£€æŸ¥ç³»ç»Ÿèµ„æº
   - ç®€åŒ–ç”Ÿæˆå‚æ•°

### æ—¥å¿—æ–‡ä»¶ä½ç½®
- GUIæ—¥å¿—: `logs/gui_demo.log`
- åç«¯æ—¥å¿—: `logs/poe2_orchestrator.log`
- PoB2æ—¥å¿—: `logs/pob2_integration.log`

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ‰©å±•æ–°åŠŸèƒ½

1. **æ·»åŠ æ–°çš„æœåŠ¡**:
   ```python
   # åœ¨services/ç›®å½•ä¸‹åˆ›å»ºæ–°æœåŠ¡
   class NewService(QObject):
       def __init__(self):
           super().__init__()
   ```

2. **æ·»åŠ æ–°çš„ç»„ä»¶**:
   ```python
   # åœ¨widgets/ç›®å½•ä¸‹åˆ›å»ºæ–°ç»„ä»¶
   class NewWidget(QWidget):
       def __init__(self):
           super().__init__()
   ```

3. **æ‰©å±•é”™è¯¯å¤„ç†**:
   ```python
   # æ·»åŠ æ–°çš„é”™è¯¯ç±»å‹å’Œå¤„ç†é€»è¾‘
   class CustomErrorType(Enum):
       NEW_ERROR = "new_error"
   ```

### æ€§èƒ½ä¼˜åŒ–

1. **å‡å°‘UIé˜»å¡**: æ‰€æœ‰è€—æ—¶æ“ä½œéƒ½åœ¨åå°çº¿ç¨‹æ‰§è¡Œ
2. **æ™ºèƒ½ç¼“å­˜**: ç¼“å­˜å¸¸ç”¨æ•°æ®å’Œè®¡ç®—ç»“æœ
3. **å»¶è¿ŸåŠ è½½**: æŒ‰éœ€åˆå§‹åŒ–ç»„ä»¶å’ŒæœåŠ¡
4. **èµ„æºæ¸…ç†**: æ­£ç¡®æ¸…ç†çº¿ç¨‹å’Œå®šæ—¶å™¨èµ„æº

## ğŸ“š APIå‚è€ƒ

è¯¦ç»†çš„APIæ–‡æ¡£è¯·å‚è€ƒå„ä¸ªæ¨¡å—çš„docstringå’Œç±»å‹æ³¨é‡Šã€‚

### ä¸»è¦æ¥å£:

- `BackendClient` - åç«¯é€šä¿¡æ¥å£
- `DataConverter` - æ•°æ®è½¬æ¢æ¥å£
- `StatusManager` - çŠ¶æ€ç®¡ç†æ¥å£
- `ErrorHandler` - é”™è¯¯å¤„ç†æ¥å£
- `PoB2StatusWidget` - PoB2ç›‘æ§æ¥å£

## ğŸ‰ æ€»ç»“

è¿™ä¸ªé›†æˆç³»ç»Ÿæä¾›äº†:

âœ… **å®Œæ•´çš„å¼‚æ­¥æ¶æ„** - éé˜»å¡çš„ç”¨æˆ·ä½“éªŒ
âœ… **æ™ºèƒ½é”™è¯¯å¤„ç†** - ç”¨æˆ·å‹å¥½çš„é”™è¯¯åé¦ˆ
âœ… **å®æ—¶çŠ¶æ€ç›‘æ§** - å…¨é¢çš„ç³»ç»Ÿå¥åº·æ£€æŸ¥
âœ… **PoB2æ·±åº¦é›†æˆ** - æ— ç¼çš„PoB2æœåŠ¡é›†æˆ
âœ… **ç±»å‹å®‰å…¨è½¬æ¢** - å¯é çš„æ•°æ®è½¬æ¢æœºåˆ¶
âœ… **å¯æ‰©å±•æ¶æ„** - æ˜“äºæ·»åŠ æ–°åŠŸèƒ½å’Œç»„ä»¶

é€šè¿‡è¿™ä¸ªé›†æˆç³»ç»Ÿï¼Œç”¨æˆ·å¯ä»¥äº«å—åˆ°æµç•…ã€å¯é ã€åŠŸèƒ½ä¸°å¯Œçš„PoE2æ„ç­‘ç”Ÿæˆä½“éªŒã€‚