PoE2 å››å¤§æ ¸å¿ƒæ•°æ®æºè®¾ç½®é…ç½®æŒ‡å¯¼

=== æ•°æ®æºæ¶æ„æ¦‚è¿° ===
æœ¬ç³»ç»Ÿå®Œå…¨åŸºäºå››ä¸ªçœŸå®ã€å¯ç”¨çš„PoE2æ•°æ®æºæ„å»ºï¼Œç¡®ä¿æ‰€æœ‰æ¨èéƒ½åŸºäºçœŸå®æ¸¸æˆæ•°æ®ã€‚

ğŸ¯ å››å¤§æ ¸å¿ƒæ•°æ®æº:
1. PoE2Scout API - å®æ—¶å¸‚åœºä»·æ ¼æ•°æ®
2. PoE Ninjaçˆ¬è™« - Metaè¶‹åŠ¿åˆ†æ  
3. Path of Building 2 - å®˜æ–¹æ¸¸æˆæ•°æ®å’Œè®¡ç®—å¼•æ“
4. PoE2DBæ•°æ®åº“ - å®Œæ•´æ¸¸æˆæ•°æ®åº“

=== 1. PoE2Scout API è®¾ç½® ===

æ•°æ®æºä¿¡æ¯:
- å®˜ç½‘: https://poe2scout.com
- APIåŸºç¡€URL: https://poe2scout.com/api
- æ•°æ®ç±»å‹: ç‰©å“ä»·æ ¼ã€è´§å¸æ±‡ç‡ã€å¸‚åœºè¶‹åŠ¿
- æ›´æ–°é¢‘ç‡: å®æ—¶ (15åˆ†é’Ÿåˆ·æ–°)

é…ç½®å‚æ•°:
```python
poe2scout_config = {
    "base_url": "https://poe2scout.com/api",
    "timeout": 10,
    "rate_limit": {
        "requests_per_minute": 30,
        "backoff_factor": 2
    },
    "cache_ttl": 900,  # 15åˆ†é’Ÿç¼“å­˜
    "leagues": ["Standard", "Hardcore", "SSF Standard", "SSF Hardcore"]
}
```

ä½¿ç”¨ç¤ºä¾‹:
```python
from src.poe2build.data_sources.poe2scout.api_client import get_poe2scout_client

client = get_poe2scout_client()
prices = client.get_item_prices("Exalted Orb", league="Standard")
exchange_rates = client.get_currency_exchange("Divine Orb", "Chaos Orb")
```

é”™è¯¯å¤„ç†:
- è¿æ¥è¶…æ—¶: è‡ªåŠ¨é‡è¯•3æ¬¡ï¼ŒæŒ‡æ•°é€€é¿
- APIé™æµ: æ™ºèƒ½é€Ÿç‡æ§åˆ¶ï¼Œé¿å…å°ç¦
- æ•°æ®å¼‚å¸¸: ä½¿ç”¨ç¼“å­˜æ•°æ®é™çº§
- æœåŠ¡ä¸å¯ç”¨: åˆ‡æ¢åˆ°å¤‡ç”¨æ•°æ®æº

ç›‘æ§æŒ‡æ ‡:
- APIå“åº”æ—¶é—´ < 2ç§’
- æ•°æ®å‡†ç¡®ç‡ > 95%
- å¯ç”¨æ€§ > 99%
- ç¼“å­˜å‘½ä¸­ç‡ > 80%

=== 2. PoE Ninja Metaåˆ†æè®¾ç½® ===

æ•°æ®æºä¿¡æ¯:
- å®˜ç½‘: https://poe.ninja/poe2/builds
- çˆ¬è™«ç›®æ ‡: æµè¡Œæ„ç­‘ã€æŠ€èƒ½ä½¿ç”¨ç»Ÿè®¡ã€å‡åè¶‹åŠ¿
- æ•°æ®ç±»å‹: æ„ç­‘é…ç½®ã€Metaè¶‹åŠ¿ã€ç©å®¶ç»Ÿè®¡
- æ›´æ–°é¢‘ç‡: æ¯å°æ—¶

é…ç½®å‚æ•°:
```python
ninja_config = {
    "base_url": "https://poe.ninja/poe2",
    "user_agent": "PoE2BuildGenerator/2.0 (+https://github.com/zhakil/poe2build)",
    "timeout": 15,
    "rate_limit": {
        "requests_per_minute": 10,
        "backoff_factor": 3,
        "respect_robots_txt": True
    },
    "cache_ttl": 3600,  # 1å°æ—¶ç¼“å­˜
    "max_builds_per_request": 100
}
```

çˆ¬è™«ç­–ç•¥:
- éµå®ˆrobots.txtè§„åˆ™
- å‹å–„çš„çˆ¬è™«é—´éš” (6ç§’/è¯·æ±‚)
- ä½¿ç”¨çœŸå®æµè§ˆå™¨User-Agent
- é¿å…å¹¶å‘è¯·æ±‚è¿‡è½½æœåŠ¡å™¨

ä½¿ç”¨ç¤ºä¾‹:
```python
from src.poe2build.data_sources.ninja.scraper import get_ninja_scraper

scraper = get_ninja_scraper()
popular_builds = scraper.get_popular_builds("Standard", limit=50)
skill_stats = scraper.get_skill_usage_stats("Lightning Arrow")
ascendancy_trends = scraper.get_ascendancy_trends("Deadeye")
```

æ•°æ®æ¸…æ´—:
- è¿‡æ»¤ä¸å®Œæ•´çš„æ„ç­‘æ•°æ®
- å»é‡ç›¸ä¼¼åº¦è¿‡é«˜çš„æ„ç­‘
- éªŒè¯æŠ€èƒ½å®çŸ³æ­é…åˆç†æ€§
- æ ‡è®°å¼‚å¸¸æ•°å€¼å’Œé…ç½®

ç”Ÿæ€è´£ä»»:
- ä¸¥æ ¼éµå®ˆçˆ¬è™«ç¤¼ä»ª
- ä¸å¯¹æœåŠ¡å™¨é€ æˆè´Ÿæ‹…
- åˆç†ç¼“å­˜å‡å°‘è¯·æ±‚
- æ”¯æŒç½‘ç«™å¯æŒç»­å‘å±•

=== 3. Path of Building 2 é›†æˆè®¾ç½® ===

æ•°æ®æºä¿¡æ¯:
- GitHubé¡¹ç›®: https://github.com/PathOfBuildingCommunity/PathOfBuilding
- æœ¬åœ°å®‰è£…: è‡ªåŠ¨æ£€æµ‹å¸¸è§å®‰è£…è·¯å¾„
- æ•°æ®ç±»å‹: æŠ€èƒ½å®çŸ³ã€å¤©èµ‹æ ‘ã€åŸºç¡€ç‰©å“ã€è®¡ç®—å¼•æ“
- åŒæ¨¡å¼æ”¯æŒ: GitHubåœ¨çº¿ + æœ¬åœ°å®‰è£…

é…ç½®å‚æ•°:
```python
pob2_config = {
    "github_mode": {
        "enabled": True,
        "base_url": "https://raw.githubusercontent.com/PathOfBuildingCommunity/PathOfBuilding2/dev/Data",
        "cache_ttl": 86400,  # 24å°æ—¶ç¼“å­˜
        "timeout": 30
    },
    "local_mode": {
        "enabled": True,
        "search_paths": [
            "C:/Program Files (x86)/Path of Building Community",
            "C:/Program Files/Path of Building Community",
            "D:/Games/Path of Building Community",
            os.path.expanduser("~/Documents/Path of Building Community")
        ],
        "data_subdirs": ["Data", "TreeData", "ModData"]
    },
    "fallback_priority": ["local", "github", "cache"]
}
```

è‡ªåŠ¨æ£€æµ‹é€»è¾‘:
```python
def detect_pob2_installation():
    # 1. æ£€æŸ¥æœ¬åœ°å®‰è£…
    for path in pob2_config["local_mode"]["search_paths"]:
        if os.path.exists(os.path.join(path, "Path of Building.exe")):
            return {"type": "local", "path": path}
    
    # 2. æ£€æŸ¥GitHubæ¨¡å¼å¯ç”¨æ€§
    if test_github_connectivity():
        return {"type": "github", "path": None}
    
    # 3. ä½¿ç”¨ç¼“å­˜æ•°æ®
    return {"type": "cache", "path": "data/pob2_cache/"}
```

ä½¿ç”¨ç¤ºä¾‹:
```python
from src.poe2build.data_sources.pob2.data_extractor import get_pob2_extractor

extractor = get_pob2_extractor(use_github=True)
if extractor.is_available():
    skills = extractor.get_skill_gems()
    passives = extractor.get_passive_nodes()
    items = extractor.get_base_items()
```

è®¡ç®—å¼•æ“é›†æˆ:
- åˆ©ç”¨PoB2çš„DPS/EHPç²¾ç¡®è®¡ç®—
- æ”¯æŒå¤æ‚çš„æŠ€èƒ½ä¼¤å®³è®¡ç®—
- å¤©èµ‹æ ‘è·¯å¾„ä¼˜åŒ–ç®—æ³•
- è£…å¤‡æ­é…æ•ˆæœè®¡ç®—

æ•°æ®åŒæ­¥ç­–ç•¥:
- æ¯æ—¥æ£€æŸ¥GitHubæ•°æ®æ›´æ–°
- æœ¬åœ°æ•°æ®ç‰ˆæœ¬æ£€æµ‹
- å¢é‡æ›´æ–°æœºåˆ¶
- æ•°æ®ä¸€è‡´æ€§éªŒè¯

=== 4. PoE2DB æ•°æ®åº“è®¾ç½® ===

æ•°æ®æºä¿¡æ¯:
- å®˜ç½‘: https://poe2db.tw/cn/
- APIæ¥å£: å…¬å¼€çš„æŸ¥è¯¢æ¥å£
- æ•°æ®ç±»å‹: è£…å¤‡è¯¦æƒ…ã€æŠ€èƒ½è¯¦æƒ…ã€å‡åä¿¡æ¯ã€æ¸¸æˆæœºåˆ¶
- æœ¬åœ°åŒ–: ä¸­æ–‡ä¼˜å…ˆï¼Œè‹±æ–‡å¤‡ç”¨

é…ç½®å‚æ•°:
```python
poe2db_config = {
    "base_url": "https://poe2db.tw",
    "api_endpoints": {
        "items": "/cn/items",
        "skills": "/cn/skills", 
        "ascendancy": "/cn/ascendancy",
        "search": "/cn/search"
    },
    "timeout": 20,
    "rate_limit": {
        "requests_per_minute": 20,
        "backoff_factor": 1.5
    },
    "cache_ttl": 7200,  # 2å°æ—¶ç¼“å­˜
    "language_priority": ["cn", "en"]
}
```

å¥åº·æ£€æŸ¥:
```python
def health_check_poe2db():
    try:
        response = requests.get(f"{base_url}/cn/", timeout=10)
        return {
            "status": "healthy" if response.status_code == 200 else "unhealthy",
            "response_time": response.elapsed.total_seconds(),
            "last_check": datetime.now()
        }
    except Exception as e:
        return {"status": "error", "error": str(e)}
```

ä½¿ç”¨ç¤ºä¾‹:
```python
from src.poe2build.data_sources.poe2db.api_client import get_poe2db_client

client = get_poe2db_client()
item_detail = client.get_item_detail("Lightning Arrow")
skill_info = client.get_skill_detail("Lightning Arrow", level=20)
ascendancy_info = client.get_ascendancy_info("Deadeye")
```

æ•°æ®å¤„ç†:
- ä¸­è‹±æ–‡æ•°æ®åˆå¹¶
- å±æ€§æ•°å€¼æ ‡å‡†åŒ–
- æŠ€èƒ½æè¿°è§£æ
- å‡åå¤©èµ‹å…³è”åˆ†æ

=== ç»Ÿä¸€æ•°æ®æºç®¡ç† ===

å¥åº·æ£€æŸ¥ç³»ç»Ÿ:
```python
from src.poe2build.data_sources import health_check_all_sources

def monitor_all_sources():
    health = health_check_all_sources()
    for source, status in health.items():
        if not status.get('available', True):
            logger.warning(f"æ•°æ®æº {source} ä¸å¯ç”¨: {status}")
        else:
            logger.info(f"æ•°æ®æº {source} æ­£å¸¸è¿è¡Œ")
    return health
```

ç»Ÿä¸€æ¥å£ä½¿ç”¨:
```python
from src.poe2build.data_sources import get_all_four_sources

def initialize_all_sources():
    scout, ninja, pob2, poe2db = get_all_four_sources()
    
    # éªŒè¯æ‰€æœ‰æ•°æ®æºå¯ç”¨æ€§
    sources_status = {
        "poe2scout": scout is not None,
        "poe_ninja": ninja is not None, 
        "pob2": pob2.is_available(),
        "poe2db": poe2db.health_check()["status"] == "healthy"
    }
    
    available_count = sum(sources_status.values())
    logger.info(f"å¯ç”¨æ•°æ®æº: {available_count}/4")
    
    return scout, ninja, pob2, poe2db
```

é”™è¯¯é™çº§ç­–ç•¥:
```python
def get_data_with_fallback(primary_source, fallback_sources, query):
    try:
        return primary_source.query(query)
    except Exception as e:
        logger.warning(f"ä¸»æ•°æ®æºå¤±è´¥: {e}")
        for fallback in fallback_sources:
            try:
                return fallback.query(query)
            except Exception:
                continue
        # æœ€åä½¿ç”¨ç¼“å­˜æ•°æ®
        return get_cached_data(query)
```

=== ç¼“å­˜å’Œæ€§èƒ½ä¼˜åŒ– ===

ç¼“å­˜ç­–ç•¥:
```python
cache_config = {
    "poe2scout": {
        "ttl": 900,  # 15åˆ†é’Ÿ
        "max_size": 10000,
        "eviction": "LRU"
    },
    "poe_ninja": {
        "ttl": 3600,  # 1å°æ—¶
        "max_size": 5000,
        "eviction": "LRU"
    },
    "pob2": {
        "ttl": 86400,  # 24å°æ—¶
        "max_size": 50000,
        "eviction": "LFU"
    },
    "poe2db": {
        "ttl": 7200,  # 2å°æ—¶
        "max_size": 20000,
        "eviction": "LRU"
    }
}
```

è¿æ¥æ± é…ç½®:
```python
import requests
from requests.adapters import HTTPAdapter
from urllib3.util.retry import Retry

def setup_session():
    session = requests.Session()
    
    # é‡è¯•ç­–ç•¥
    retry_strategy = Retry(
        total=3,
        backoff_factor=1,
        status_forcelist=[429, 500, 502, 503, 504]
    )
    
    # HTTPé€‚é…å™¨
    adapter = HTTPAdapter(
        max_retries=retry_strategy,
        pool_connections=10,
        pool_maxsize=20
    )
    
    session.mount("http://", adapter)
    session.mount("https://", adapter)
    
    return session
```

=== é…ç½®æ–‡ä»¶ç®¡ç† ===

ä¸»é…ç½®æ–‡ä»¶ (config.json):
```json
{
    "data_sources": {
        "poe2scout": {
            "enabled": true,
            "base_url": "https://poe2scout.com/api",
            "rate_limit": 30,
            "timeout": 10,
            "cache_ttl": 900
        },
        "poe_ninja": {
            "enabled": true,
            "base_url": "https://poe.ninja/poe2",
            "rate_limit": 10,
            "timeout": 15,
            "cache_ttl": 3600
        },
        "pob2": {
            "enabled": true,
            "github_mode": true,
            "local_detection": true,
            "cache_ttl": 86400
        },
        "poe2db": {
            "enabled": true,
            "base_url": "https://poe2db.tw",
            "language": "cn",
            "cache_ttl": 7200
        }
    },
    "global_settings": {
        "max_concurrent_requests": 5,
        "default_league": "Standard",
        "cache_directory": "data/cache/",
        "log_level": "INFO"
    }
}
```

ç¯å¢ƒå˜é‡æ”¯æŒ:
```bash
# è®¾ç½®æ•°æ®æºä¼˜å…ˆçº§
export POE2_DATA_SOURCES_PRIORITY="pob2,poe2scout,poe2db,ninja"

# è®¾ç½®ç¼“å­˜ç›®å½•
export POE2_CACHE_DIR="/path/to/cache"

# è®¾ç½®æ—¥å¿—çº§åˆ«
export POE2_LOG_LEVEL="DEBUG"

# ç¦ç”¨ç‰¹å®šæ•°æ®æº
export POE2_DISABLE_NINJA="true"
```

=== éƒ¨ç½²éªŒè¯æ¸…å• ===

éƒ¨ç½²å‰æ£€æŸ¥:
â–¡ å››å¤§æ•°æ®æºè¿é€šæ€§æµ‹è¯•
â–¡ é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®æ€§éªŒè¯
â–¡ ç¼“å­˜ç›®å½•æƒé™æ£€æŸ¥
â–¡ æ—¥å¿—æ–‡ä»¶å¯å†™æ€§éªŒè¯
â–¡ ç½‘ç»œä»£ç†è®¾ç½®ï¼ˆå¦‚éœ€è¦ï¼‰

åŠŸèƒ½éªŒè¯:
â–¡ æ•°æ®æºå¥åº·æ£€æŸ¥æ­£å¸¸
â–¡ ç¼“å­˜æœºåˆ¶å·¥ä½œæ­£å¸¸
â–¡ é”™è¯¯é™çº§ç­–ç•¥æœ‰æ•ˆ
â–¡ é€Ÿç‡é™åˆ¶é…ç½®æ­£ç¡®
â–¡ æ—¥å¿—è®°å½•å®Œæ•´

æ€§èƒ½éªŒè¯:
â–¡ æ•°æ®è·å–å“åº”æ—¶é—´ < 3ç§’
â–¡ å†…å­˜ä½¿ç”¨ç¨³å®š
â–¡ ç¼“å­˜å‘½ä¸­ç‡ > 70%
â–¡ ç½‘ç»œè¯·æ±‚åˆç†åˆ†å¸ƒ
â–¡ ç³»ç»Ÿèµ„æºå ç”¨æ­£å¸¸

=== æ•…éšœæ’é™¤æŒ‡å— ===

å¸¸è§é—®é¢˜:

Q: PoE2Scout APIè¿”å›403é”™è¯¯ï¼Ÿ
A: æ£€æŸ¥User-Agentè®¾ç½®ï¼Œç¡®ä¿é€Ÿç‡é™åˆ¶æœªè¶…æ ‡ï¼Œå¯èƒ½éœ€è¦æ›´æ¢IP

Q: PoE Ninjaçˆ¬è™«è¢«å°ç¦ï¼Ÿ
A: å¢åŠ è¯·æ±‚é—´éš”ï¼Œæ£€æŸ¥robots.txtéµå®ˆæƒ…å†µï¼Œä½¿ç”¨ä»£ç†IP

Q: PoB2æœ¬åœ°æ•°æ®æ— æ³•è¯»å–ï¼Ÿ
A: æ£€æŸ¥å®‰è£…è·¯å¾„ï¼ŒéªŒè¯æ•°æ®æ–‡ä»¶å®Œæ•´æ€§ï¼Œåˆ‡æ¢åˆ°GitHubæ¨¡å¼

Q: PoE2DBè¿æ¥è¶…æ—¶ï¼Ÿ
A: æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œå¯èƒ½æ˜¯åœ°åŒºé™åˆ¶ï¼Œä½¿ç”¨ä»£ç†æˆ–VPN

Q: ç¼“å­˜æ–‡ä»¶æŸåï¼Ÿ
A: æ¸…ç©ºç¼“å­˜ç›®å½•é‡æ–°ç”Ÿæˆï¼Œæ£€æŸ¥ç£ç›˜ç©ºé—´å’Œæƒé™

æ€§èƒ½ä¼˜åŒ–å»ºè®®:
- åˆç†è®¾ç½®ç¼“å­˜TTLï¼Œå¹³è¡¡æ•°æ®æ–°é²œåº¦å’Œæ€§èƒ½
- ä½¿ç”¨è¿æ¥æ± å‡å°‘è¿æ¥å»ºç«‹å¼€é”€
- æ‰¹é‡è¯·æ±‚å‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•°
- ç›‘æ§æ•°æ®æºå“åº”æ—¶é—´ï¼ŒåŠæ—¶è°ƒæ•´ç­–ç•¥
- å®šæœŸæ¸…ç†è¿‡æœŸç¼“å­˜å’Œæ—¥å¿—æ–‡ä»¶

=== å¼€å‘è€…æ³¨æ„äº‹é¡¹ ===

ä»£ç è§„èŒƒ:
- æ‰€æœ‰ç½‘ç»œè¯·æ±‚å¿…é¡»æœ‰è¶…æ—¶è®¾ç½®
- å¼‚å¸¸å¤„ç†è¦è¯¦ç»†è®°å½•é”™è¯¯ä¿¡æ¯
- å…³é”®æ“ä½œè¦æœ‰é‡è¯•æœºåˆ¶
- æ•æ„Ÿé…ç½®ä½¿ç”¨ç¯å¢ƒå˜é‡

æµ‹è¯•è¦æ±‚:
- æ¯ä¸ªæ•°æ®æºéƒ½è¦æœ‰å•å…ƒæµ‹è¯•
- ç½‘ç»œè¯·æ±‚è¦æœ‰mockæµ‹è¯•
- é”™è¯¯åœºæ™¯è¦æœ‰ä¸“é—¨æµ‹è¯•
- æ€§èƒ½æµ‹è¯•è¦å®šæœŸæ‰§è¡Œ

ç›‘æ§å‘Šè­¦:
- æ•°æ®æºä¸å¯ç”¨è¦ç«‹å³å‘Šè­¦
- å“åº”æ—¶é—´å¼‚å¸¸è¦åŠæ—¶é€šçŸ¥
- ç¼“å­˜å‘½ä¸­ç‡ä¸‹é™è¦å…³æ³¨
- é”™è¯¯ç‡è¶…è¿‡é˜ˆå€¼è¦å¤„ç†

æ–‡æ¡£ç»´æŠ¤:
- APIå˜æ›´è¦åŠæ—¶æ›´æ–°æ–‡æ¡£
- é…ç½®å‚æ•°è¦æœ‰è¯¦ç»†è¯´æ˜
- æ•…éšœæ’é™¤æŒ‡å—è¦ä¿æŒæœ€æ–°
- ä½¿ç”¨ç¤ºä¾‹è¦éªŒè¯å¯ç”¨æ€§